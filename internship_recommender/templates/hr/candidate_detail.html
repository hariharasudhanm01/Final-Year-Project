{% extends "base.html" %}

{% block title %}Candidate Profile - HR Portal{% endblock %}

{% block content %}
<div class="with-sidebar">
  <div class="sidebar">
    <h2>HR Portal</h2>
    <nav>
      <ul>
        <li><a href="/hr/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a href="/hr/candidates"><i class="fas fa-users"></i> Candidates</a></li>
        <li><a href="/hr/jobs"><i class="fas fa-briefcase"></i> Job Postings</a></li>
        <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
    </nav>
  </div>

  <div class="main-content">
    <div class="top-nav">
      <h1>Candidate Profile</h1>
      <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="/hr/candidates" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back</a>
        <div class="user-avatar">
          {{ (user.full_name or user.username)[0]|upper if user else 'H' }}
        </div>
      </div>
    </div>
    
    <div class="content">
      <div class="card" style="margin-bottom: 2rem;">
        <h2 style="margin-top: 0; color: var(--primary);">
          <i class="fas fa-user-circle"></i> {{ candidate.full_name or candidate.username }}
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
          <div>
            <p><strong><i class="fas fa-envelope"></i> Email:</strong><br>{{ candidate.email }}</p>
          </div>
          {% if candidate.degree %}
          <div>
            <p><strong><i class="fas fa-graduation-cap"></i> Degree:</strong><br>{{ candidate.degree }}</p>
          </div>
          {% endif %}
          {% if candidate.study_year %}
          <div>
            <p><strong><i class="fas fa-calendar-alt"></i> Study Year:</strong><br>Year {{ candidate.study_year }}</p>
          </div>
          {% endif %}
          {% if candidate.stream %}
          <div>
            <p><strong><i class="fas fa-book"></i> Stream:</strong><br>{{ candidate.stream }}</p>
          </div>
          {% endif %}
          {% if candidate.sector %}
          <div>
            <p><strong><i class="fas fa-building"></i> Sector:</strong><br>{{ candidate.sector }}</p>
          </div>
          {% endif %}
          <div>
            <p><strong><i class="fas fa-calendar"></i> Joined:</strong><br>{{ candidate.created_at[:10] if candidate.created_at else 'N/A' }}</p>
          </div>
        </div>
      </div>

      {% if candidate.skills %}
      <div class="card" style="margin-bottom: 2rem;">
        <h3><i class="fas fa-tools"></i> Skills</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1rem;">
          {% for skill in candidate.skills.split(',') %}
            <span style="background: var(--primary); color: white; padding: 0.5rem 1rem; border-radius: 25px; font-size: 0.95rem; font-weight: 500;">{{ skill.strip() }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if candidate.resume_path %}
      <div class="card" style="margin-bottom: 2rem;">
        <h3><i class="fas fa-file-pdf"></i> Resume</h3>
        {% set resume_filename = candidate.resume_path.split('/')[-1] if '/' in candidate.resume_path else candidate.resume_path.split('\\')[-1] %}
        <a href="/uploads/{{ resume_filename }}" target="_blank" class="btn">
          <i class="fas fa-download"></i> Download Resume
        </a>
        <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
          <i class="fas fa-info-circle"></i> File: {{ resume_filename }}
        </p>
      </div>
      {% endif %}

      {% if history %}
      <div class="card">
        <h3><i class="fas fa-history"></i> Recommendation History</h3>
        <div style="display: grid; gap: 1rem; margin-top: 1rem;">
          {% for rec in history %}
          <div style="border-left: 3px solid var(--primary); padding: 1rem; background: var(--accent); border-radius: var(--border-radius);">
            <p style="margin: 0.5rem 0;"><strong>{{ rec.role }}</strong></p>
            {% if rec.location %}
            <p style="margin: 0.5rem 0; color: #666;"><i class="fas fa-map-marker-alt"></i> {{ rec.location }}</p>
            {% endif %}
            {% if rec.salary_range_low and rec.salary_range_high %}
            <p style="margin: 0.5rem 0; color: #666;">
              <i class="fas fa-rupee-sign"></i> Salary: ₹{{ rec.salary_range_low|int / 100000 }} LPA - ₹{{ rec.salary_range_high|int / 100000 }} LPA
            </p>
            {% endif %}
            {% if rec.skills_used %}
            <p style="margin: 0.5rem 0;">
              <strong>Skills Used:</strong> 
              {% for skill in rec.skills_used.split(',')[:5] %}
                <span style="background: #667eea; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; display: inline-block; margin: 0.25rem 0.25rem 0.25rem 0;">{{ skill.strip() }}</span>
              {% endfor %}
            </p>
            {% endif %}
            <p style="margin: 0.5rem 0 0 0; color: #999; font-size: 0.9rem;">{{ rec.created_at[:16] if rec.created_at else '' }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
  .card {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: 0 2px 10px var(--shadow);
  }
</style>
{% endblock %}

